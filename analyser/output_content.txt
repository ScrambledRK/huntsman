packageat.something.calculator;importat.dotpoint.math.MathUtil;importat.dotpoint.math.vector.Vector2;classEdgeContainer{publicvarhorizontal:Array<Vertex>;publicvarvertical:Array<Vertex>;publicfunctionnew(){this.vertical=newArray<Vertex>();this.horizontal=newArray<Vertex>();}publicfunctioninsert(a:Vertex,b:Vertex):Void{if(this.isVertical(a,b)){varindex:Int=this.getIndex(a.x,true);this.vertical.insert(index*2,a);this.vertical.insert(index*2,b);}else{varindex:Int=this.getIndex(a.y,false);this.horizontal.insert(index*2,a);this.horizontal.insert(index*2,b);}}publicfunctionremove(a:Vertex,b:Vertex):Void{if(this.isVertical(a,b)){this.vertical.remove(a);this.vertical.remove(b);}else{this.horizontal.remove(a);this.horizontal.remove(b);}}publicfunctionsplit(start:Vertex,dir:Vector2):Vertex{varisVertical:Bool=Math.abs(dir.x)<Math.abs(dir.y);if(isVertical){varystep:Int=dir.y<0?-1:1;varhstart:Int=this.getIndex(start.y,false)-1;varhlength:Int=this.horizontal.length>>1;while((hstart+=ystep)>=0&&hstart<=hlength){varhindex:Int=hstart*2;vara:Vertex=this.horizontal[hindex+0];varb:Vertex=this.horizontal[hindex+1];if(a==start||b==start)continue;if((start.x>=a.x&&start.x<=b.x)||(start.x>=b.x&&start.x<=a.x)){returnthis.insertSplit(start,a,b);}}}else{varxstep:Int=dir.x<0?-1:1;varvstart:Int=this.getIndex(start.x,true)-1;varvlength:Int=this.vertical.length>>1;while((vstart+=xstep)>=0&&vstart<=vlength){varvindex:Int=vstart*2;vara:Vertex=this.vertical[vindex+0];varb:Vertex=this.vertical[vindex+1];if(a==start||b==start)continue;if((start.y>=a.y&&start.y<=b.y)||(start.y>=b.y&&start.y<=a.y)){returnthis.insertSplit(start,a,b);}}}returnnull;}privatefunctioninsertSplit(start:Vertex,a:Vertex,b:Vertex):Vertex{varsplit:Vertex=newVertex(null);split.index=Math.min(a.index,b.index)+Math.min(1,Math.abs(b.index-a.index))*0.5;if(this.isVertical(a,b)){split.x=a.x;split.y=start.y;}else{split.x=start.x;split.y=a.y;}ifdebugtrace("split",start,"--X--",a,b+": ["+split.index+"]");endthis.remove(a,b);this.insert(split,start);this.insert(split,a);this.insert(split,b);a.removeNeighbor(b);b.removeNeighbor(a);a.insertNeighbor(split);b.insertNeighbor(split);split.insertNeighbor(start);split.insertNeighbor(a);split.insertNeighbor(b);start.insertNeighbor(split);returnsplit;}privatefunctiongetIndex(value:Float,isVertical:Bool):Int{if(isVertical){varvlength:Int=this.vertical.length>>1;for(vin0...vlength){if(this.vertical[v*2].x>value)returnv;}returnvlength;}else{varhlength:Int=this.horizontal.length>>1;for(hin0...hlength){if(this.horizontal[h*2].y>value)returnh;}returnhlength;}return-1;}publicfunctionisVertical(a:Vertex,b:Vertex):Bool{ifdebugif(!MathUtil.isEqual(a.x,b.x)&&!MathUtil.isEqual(a.y,b.y))throw"both vertices are not perpendicular";endreturnMathUtil.isEqual(a.x,b.x);}}classSOMEFUN<THAHA>{}privateclassYES<NO<LOL:at.dotpoint.MAYBE,KK:Nay>>